---
// Search Modal Component
import Search from "astro-pagefind/components/Search";
import SearchIcon from "@/icons/svg/SearchIcon.astro";
import CloseIcon from "@/icons/svg/CloseIcon.astro";

interface Props {
  class?: string;
}

const className = {
  button1: 'flex cursor-pointer items-center justify-between rounded-lg border-1 border-primary-text bg-primary-bg px-2 py-1.5 w-full',
  button2: 'flex cursor-pointer items-center justify-center rounded-full border-none bg-transparent hover:bg-primary-text/5 transition-colors p-2',
}

---

<!-- Search Component with Alpine.js -->
<div class={Astro.props.class} x-data="{
  open() { $refs.modal.showModal() },
  close() { $refs.modal.close() },
  checkClose(e) { !this.$refs.content.contains(e.target) && this.close() },
  handleKeydown(e) {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      this.open();
    }
  }
}" 
  @keydown.window="handleKeydown"
>
  <!-- Search Icon Button with centered layout and shortcut indicator -->
  <button
    @click="open"
    aria-label="Open search"
    class={className.button1}
  >
    <SearchIcon />
    <span class="">âŒ˜ K</span>
  </button>

  <!-- Search Modal Dialog -->
  <dialog
    x-ref="modal"
    @click="checkClose"
    @keydown.escape="close"
    class="border-none bg-primary-ui rounded-lg p-0 max-w-2xl w-11/12 shadow-lg backdrop:bg-primary-text/50 backdrop:backdrop-blur-sm mt-16 mx-auto overflow-hidden"
  >
    <div x-ref="content" class="p-5 max-h-[calc(100vh-4rem)] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="m-0 text-2xl">Search</h2>
        <button
          @click="close"
          tabindex="-1"
          aria-label="Close search"
          class={className.button2}
        >
          <CloseIcon />
        </button>
      </div>
      <div>
        <Search id="search" uiOptions={{ showImages: false }} />
      </div>
    </div>
  </dialog>
</div>
