---
// PostList component for displaying posts with view count, date, and title
import { getCollection } from "astro:content";

const allPosts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// ViewCount functionality (simulated for now)
// In a real application, this would likely be fetched from a database or analytics service
const viewCounts: Record<string, number> = {
  'hello-astro': 42,
  'getting-started': 28
};
---

<div class="post-list-container">
  <h2>Latest Blog Posts</h2>

  <ul class="posts-list">
    {allPosts.map((post) => (
      <li class="post-item">
        <div class="post-meta">
          <time datetime={post.data.pubDate.toISOString()}>
            {post.data.pubDate.toLocaleDateString()}
          </time>
          <span class="view-count" title="View Count">
            {viewCounts[post.id] || 0} views
          </span>
        </div>
        <h3 class="post-title">
          <a href={`/posts/${post.id}`}>
            {post.data.title || 'Untitled Post'}
          </a>
        </h3>
        {post.data.description &&
          <p class="post-description">{post.data.description}</p>
        }
      </li>
    ))}
  </ul>
</div>